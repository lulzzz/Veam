@model Veam.EAM.ViewModels.BulkCheckOutSaveVM

@{
    ViewData["Title"] = "Create";
    Layout = "~/Views/Shared/_AdminlteNetcoreDetails.cshtml";
}


 
    <div class="box box-primary">
        <div class="col-md-12">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <input type="hidden" asp-for="checkoutId" />

            <div class="row">
                <div class=" col-md-4">
                    <div class="form-group">
                        <label asp-for=" checkedOutDate" class="control-label"></label>
                        <DatePicker>
                            <input asp-for="checkedOutDate" value="@DateTime.Today.ToString("MMM/dd/yyyy")" class="form-control pull-right datepicker" type="text" />
                        </DatePicker>
                        <span asp-validation-for="checkedOutDate" class="text-danger"></span>
                    </div>
                </div>

                <div class=" col-md-4">
                    <div class="form-group">
                        <label asp-for=" approveDate" class="control-label"></label>
                        <DatePicker>
                            <input asp-for=" approveDate" class="form-control pull-right datepicker" type="text" />
                        </DatePicker>
                        <span asp-validation-for=" approveDate" class="text-danger"></span>
                    </div>
                </div>

                <div class=" col-md-4">
                    <div class="form-group">
                        <label asp-for=" requestedDate" class="control-label"></label>
                        <DatePicker>
                            <input asp-for=" requestedDate" class="form-control pull-right datepicker" type="text" />
                        </DatePicker>
                        <span asp-validation-for=" requestedDate" class="text-danger"></span>
                    </div>
                </div>
            </div>

            <div class=" row">
                <div class=" col-md-6">
                    <div class="form-group">
                        <label asp-for=" requestedBy" class="control-label"></label>
                        <select asp-for=" requestedBy" class="form-control select2" asp-items="@Model.EmpList  "></select>
                        <span asp-validation-for=" requestedBy" class="text-danger"></span>
                    </div>
                </div>

                <div class=" col-md-6">
                    <div class="form-group">
                        <label asp-for=" approvedBy" class="control-label"></label>
                        <select asp-for=" approvedBy" class="form-control select2" asp-items="@Model.EmpList  "></select>
                        <span asp-validation-for=" approvedBy" class="text-danger"></span>
                    </div>
                </div>
            </div>
            <div class=" row">
                <div class=" col-md-6">
                    <div class="form-group">
                        <label asp-for="  assetConditon" class="control-label"></label>
                        <input asp-for=" assetConditon" class="form-control" />
                        <span asp-validation-for=" assetConditon " class="text-danger"></span>
                    </div>
                </div>

                <div class=" col-md-6">
                    <div class="form-group">
                        <label asp-for="  conditionNote" class="control-label"></label>
                        <input asp-for=" conditionNote" class="form-control" />
                        <span asp-validation-for=" conditionNote" class="text-danger"></span>
                    </div>
                </div>
            </div>


            <!-- Custom Tabs (Pulled to the right) -->
            <div class="nav-tabs-custom ">
                <ul class="nav nav-tabs pull-right ">
                    <li><a href="#toParent" data-toggle="tab">To Parent Asset</a></li>
                    <li class="active"><a class="btn btn-default" href="#toLocation" data-toggle="tab"> Tolocation</a></li>
                    <li><a href="#toEmp" data-toggle="tab">ToEmployee</a></li>
                    <li class="pull-left header"><i class="fa fa-th"></i>CheckOut To</li>
                </ul>

                <div class="tab-content fixed">
                    <!--To Location-->
                    <div class="tab-pane active" id="toLocation">
                        <div class="row " id="locationBox1">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for=" centerId" class="control-label"></label>
                                    <select id="centerList" onchange="loadHallByCenter()" asp-for=" centerId" class="form-control select2" asp-items="@Model.CenterList"></select>
                                    <span asp-validation-for=" centerId" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for=" hallId " class="control-label"></label>
                                    <select id="hallList" asp-for=" hallId" class="form-control select2" asp-items="@Model.HallList"></select>
                                    <span asp-validation-for=" hallId" class="text-danger"></span>
                                </div>
                            </div>

                        </div>
                        <div class=" row" id="locationBox2">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for=" subsideryId" class="control-label"></label>
                                    <select asp-for=" subsideryId" class="form-control select2" asp-items="@Model. subsideryList"></select>
                                    <span asp-validation-for=" subsideryId" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for=" managerId " class="control-label"></label>
                                    <select asp-for=" managerId" class="form-control select2" asp-items="@Model.EmpList  "></select>
                                    <span asp-validation-for=" managerId" class="text-danger"></span>
                                </div>
                            </div>

                        </div>



                    </div>
                    <!--To Employee-->
                    <div class="tab-pane " id="toEmp">
                        <div class="user box row" id="userBox">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label asp-for=" subsideryId" class="control-label"></label>
                                    <select asp-for=" subsideryId" class="form-control select2" asp-items="@Model. subsideryList"></select>
                                    <span asp-validation-for=" subsideryId" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label asp-for=" employeeId " class="control-label"></label>
                                    <select asp-for=" employeeId" class="form-control select2" asp-items="@Model.EmpList  "></select>
                                    <span asp-validation-for=" employeeId" class="text-danger"></span>
                                </div>
                            </div>


                            <div class="col-md-4">
                                <div class="form-group">
                                    <label asp-for=" departmentId " class="control-label"></label>
                                    <select asp-for=" departmentId" class="form-control select2" asp-items="@Model.deptList  "></select>
                                    <span asp-validation-for=" departmentId" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                    </div>
                    <!--To ParentAsset-->
                    <div class="tab-pane " id="toParent">
                        <div class="asset box row" id="assetBox">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label asp-for=" parentAssetId" class="control-label"></label>
                                    <select asp-for=" parentAssetId" class="form-control" asp-items="@Model.pasrntAssetList "></select>
                                </div>
                            </div>
                        </div>
                    </div>


                </div>
            </div>

        </div>
    </div>
 
<div style="padding:10px 0px; text-align:right">
    <input id="submit" type="button" value="Save" style="padding:10px 20px" />
</div>
<table id="grid-selection" class="table table-condensed table-hover table-striped">
    <thead>
        <tr>
            <th data-column-id="assetId" data-type="numeric" data-identifier="true" colspan="5">ID</th>
            <th data-column-id="assetName">Asset name</th>
            <th data-column-id="modalname" data-order="desc">Model name</th>
            <th data-column-id="serialNo" data-formatter="link" data-sortable="false">Sr No</th>
        </tr>
    </thead>
</table>


@section Styles{


    <!-- iCheck -->
    <link rel="stylesheet" href="~/adminlte/plugins/iCheck/all.css" />
    <!-- BootGrid -->
    <link href="~/lib/jquery-bootgrid/jquery.bootgrid.min.css" rel="stylesheet" />

}

@section Scripts {

    <!-- iCheck -->
    <script src="~/adminlte/plugins/iCheck/icheck.min.js"></script>
    <!-- BootGrid -->
    <script src="~/lib/jquery-bootgrid/jquery.bootgrid.min.js"></script>


    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    @*<script>
            function Reveal(it, box) {
                var vis = (box.checked) ? "block" : "none";
                document.getElementById(it).style.display = block;
            }

            function Hide(it, box) {
                var vis = (box.checked) ? "none" : "none";
                document.getElementById(it).style.display = none;
            }
        </script>*@
    @*<script>

            $(document).ready(function () {

                //click event for location
                loadHallByCenter();
            });

            function loadHallByCenter() {
                 $('#centerList').change(function () {
               var url = '@Url.Content("~/")' + "Select/GetHallbyCenterId";
                 $.getJSON(url, { centerId: $("#centerList").val() }, function (data) {
                var items = '';
                $("#hallList").empty();
                $.each(data, function (i, section) {
                    items += "<option value='" + section.value + "'>" + section.text + "</option>";
                });
                     $('#hallList').html(items);
                    });
             });
            };

        </script>*@
    <script type="text/javascript">
        var entity = 'Asset';
        var apiurl = '/api/' + entity;
        var BillItems = [];
        var items = [];
        $(document).ready(function () {

            $("#grid-selection").bootgrid({
                ajax: true,
                url: apiurl,
                selection: true,
                multiSelect: true,
                formatters: {
                    "link": function (column, row) {
                        return "<a href=\"#\">" + column.id + ": " + row.id + "</a>";
                    }
                }
            }).on("selected.rs.jquery.bootgrid", function (e, rows) {
                var rowIds = [];

                for (var i = 0; i < rows.length; i++) {
                    items.push(rows[i].assetId);
                }
                BillItems = [];
                for (var i = 0; i < items.length; i++) {
                    BillItems.push({ assetId: items[i] });
                }

            }).on("deselected.rs.jquery.bootgrid", function (e, rows) {
                var rowIds = [];

                for (var i = 0; i < rows.length; i++) {
                    var removeItem = rows[i].assetId;
                    items = jQuery.grep(items, function (value) { return value !== removeItem });
                }
                BillItems = [];
                for (var i = 0; i < items.length; i++) {
                    BillItems.push({ assetId: items[i] });
                }
            });
        });

        //Save button click function
        $('#submit').click(function () {
            //validation of order
            var isAllValid = true;
            if (BillItems.length == 0) {
                alert("Please selected atleast one item");
                isAllValid = false;
            }

            //Save if valid
            if (isAllValid) {
                var data = {
                    billNo: $('#BillNo').val(),
                    billDate: $('#BillDateDate').val(),
                    notes: $('#Notes').val(),
                    Assets: BillItems
                }

                $(this).val('Please wait...');

                $.ajax({
                    url: '/api/checkout/Bulkcheckout',
                    type: "POST",
                    data: JSON.stringify(data),
                    // dataType: "JSON",
                    contentType: "application/json",
                    success: function (d) {
                        //check is successfully save to database
                        if (d.status == true) {
                            //will send status from server side
                            alert('Successfully done.');
                            //clear form
                            BillItems = [];
                            $('#BillNo').val('');
                            $('#BillDate').val('');
                            $('#BillItems').empty();
                        }
                        else {
                            alert('Failed');
                        }
                        $('#submit').val('Save');
                    },
                    error: function () {
                        alert('Error. Please try again.');
                        $('#submit').val('Save');
                    }
                });
            }

        });

    </script>

}
